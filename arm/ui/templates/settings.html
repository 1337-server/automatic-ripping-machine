{% extends "base.html" %}
{% block title %}Settings{% endblock %}

{% block nav %}{{ super() }}{% endblock %}

{% block content %}

    <style>
        .popover {
            white-space: pre-line;
        }

        .popover-body {
            white-space: pre-wrap;
            font-weight: bold;
        }

        .popover-header {
            background-color: #f2f2f2;
            border-bottom: 1px solid #EBEBEB;
            border-radius: 5px 5px 0 0;
            font-size: 20px;
            line-height: 18px;
            margin: 0;
            padding: 8px 14px;
            font-weight: bold;
            text-align: center;
        }
    </style>
    <!-- TOAST -->
    <div aria-live="polite" aria-atomic="true">
        <!-- Position it -->
        <div style="position: absolute; top: 100px; right: 300px;">
            <div role="alert" aria-live="assertive" aria-atomic="true" class="toast position-fixed"
                 data-autohide="false" style="z-index:1000">
                <div class="toast-header">
                    <img src="static/img/apple-touch-icon.png" class="rounded mr-2" alt="arm message" height="20px"
                         width="20px">
                    <strong class="mr-auto">A.R.M Message</strong>
                    <small>now</small>
                    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="toast-body">
                    ...
                </div>
            </div>
        </div>
    </div>
    <!-- MESSAGES - We keep this here incase we need it later -->
    <div class="alert alert-success d-none" role="alert" id="success">
        <h4 class="alert-heading">Settings were saved successfully</h4>
    </div>
    <div class="alert alert-danger d-none" role="alert" id="fail">
        <h4 class="alert-heading">There was an error saving settings</h4>
    </div>
    <!-- END MESSAGES - We keep this here incase we need it later -->
    <div class="container" style="max-width: initial!important;">
        <div class="row">
            <div class="col">
                <div class="jumbotron" style="padding-top: 1rem;">
                    <div class="col-sm-12  rounded text-center">
                        <img src="static/img/arm80.png" alt="Automatic Ripping Machine">
                        <h2> ARM - Settings </h2>
                    </div>
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                               aria-controls="home" aria-selected="true">General Info</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="abcde-tab" data-toggle="tab" href="#abcde" role="tab"
                               aria-controls="abcde" aria-selected="false">abcde Config</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="settings-tab" data-toggle="tab" href="#settings" role="tab"
                               aria-controls="settings" aria-selected="false">Ripper Settings</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="uiSettings-tab" data-toggle="tab" href="#uiSettings" role="tab"
                               aria-controls="uiSettings" aria-selected="false">Ui Settings</a>
                        </li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <!-- General info -->
                        <div class="tab-pane active pt-5" id="home" role="tabpanel" aria-labelledby="home-tab">111111111111
                        </div>
                        <!-- abcde config -->
                        <div class="tab-pane pt-5" id="abcde" role="tabpanel" aria-labelledby="abcde-tab">222222222</div>
                        <!-- Ripper settings -->
                        <div class="tab-pane pt-5" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                            <form id="ripperSettings" name="ripperSettings" method="post" action="">
                                {{ form.hidden_tag() }}
                                {% for k, v in settings.items() %}
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="{{ k }}">{{ k }}: </span>
                                        </div>
                                        <input type="text" class="form-control" aria-label="{{ k }}" name="{{ k }}"
                                               placeholder="{{ v }}" value="{{ v }}" aria-describedby="{{ k }}">
                                        <a class="popovers" onClick='return false;' href=""
                                           data-content="{{ jsoncomments[k]| replace("#", "\n") }}" rel="popover"
                                           data-placement="top" data-original-title="{{ k }}">
                                            <img title="More information" src="static/img/info.png" width="30px"
                                                 height="35px" alt="More Info">
                                        </a>
                                    </div>
                                {% endfor %}
                                <button id="settings" class="btn btn-secondary btn-lg btn-block" form="ripperSettings" type="submit">Submit
                                </button>
                            </form>
                        </div>
                        <!-- ui settings -->
                        <div class="tab-pane pt-5" id="uiSettings" role="tabpanel" aria-labelledby="uiSettings-tab">
                            <form id="ui-settings" name="ui-settings" action="">
                                {{ form.hidden_tag() }}

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="index_refresh">index_refresh: </span>
                                    </div>
                                    <input type="text" class="form-control" aria-label="index_refresh"
                                           name="index_refresh" placeholder="" value="{{ ui_settings.index_refresh }}"
                                           aria-describedby="index_refresh">
                                    <a class="popovers" onClick='return false;' href="" data-content="" rel="popover"
                                       data-placement="top" data-original-title="index_refresh">
                                        <img title="More information" src="static/img/info.png" width="30px"
                                             height="35px" alt="More info">
                                    </a>
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="use_icons">use_icons: </span>
                                    </div>
                                    <input type="text" class="form-control" aria-label="use_icons" name="use_icons"
                                           value="{{ ui_settings.use_icons }}">

                                    <a class="popovers" onClick='return false;' href="" data-content="" rel="popover"
                                       data-placement="top" data-original-title="index_refresh">
                                        <img title="More information" src="static/img/info.png" width="30px"
                                             height="35px" alt="More info">
                                    </a>
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"
                                              id="save_remote_images">save_remote_images: </span>
                                    </div>
                                    <input type="text" class="form-control" aria-label="save_remote_images"
                                           name="save_remote_images" value="{{ ui_settings.save_remote_images }}">
                                    <a class="popovers" onClick='return false;' href="" data-content="" rel="popover"
                                       data-placement="top" data-original-title="save_remote_images">
                                        <img title="More information" src="static/img/info.png" width="30px"
                                             height="35px" alt="More info">
                                    </a>
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="bootstrap_skin">bootstrap_skin: </span>
                                    </div>
                                    <input type="text" class="form-control" aria-label="bootstrap_skin"
                                           name="bootstrap_skin" placeholder="" value="{{ ui_settings.bootstrap_skin }}"
                                           aria-describedby="bootstrap_skin">
                                    <a class="popovers" onClick='return false;' href="" data-content="" rel="popover"
                                       data-placement="top" data-original-title="save_remote_images">
                                        <img title="More information" src="static/img/info.png" width="30px"
                                             height="35px" alt="More info">
                                    </a>
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="language">language: </span>
                                    </div>
                                    <input type="text" class="form-control" aria-label="language" name="language"
                                           placeholder="" value="{{ ui_settings.language }}"
                                           aria-describedby="language">
                                    <a class="popovers" onClick='return false;' href="" data-content="" rel="popover"
                                       data-placement="top" data-original-title="language">
                                        <img title="More information" src="static/img/info.png" width="30px"
                                             height="35px" alt="More info">
                                    </a>
                                </div>

                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" id="database_limit">database_limit: </span>
                                    </div>
                                    <input type="text" class="form-control" aria-label="database_limit"
                                           name="database_limit" placeholder="" value="{{ ui_settings.database_limit }}"
                                           aria-describedby="database_limit">
                                    <a class="popovers" onClick='return false;' href="" data-content="" rel="popover"
                                       data-placement="top" data-original-title="database_limit">
                                        <img title="More information" src="static/img/info.png" width="30px"
                                             height="35px" alt="More info">
                                    </a>
                                </div>
                                <button id="uiSubmit" class="btn btn-secondary btn-lg btn-block" form="ui-settings"
                                        type="submit">
                                    Submit
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block footer %}{{ super() }}{% endblock %}
{% block js %}
    {{ super() }}
    <script type="application/javascript">
        $(function () {
            $('#ui-settings').submit(function (e) {
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: '/ui_settings',
                    data: $('#ui-settings').serialize()
                }).done(function (data) {
                    if (data.success === true) {
                        console.log(data)
                        var dt = new Date();
                        var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
                        $('.toast-body').html('Saved ui-settings at ' + time)
                        $('.toast').toast('show');
                    }
                });
            })
            $('#settings').submit(function (e) {
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: '/save_settings',
                    data: $('#ripperSettings').serialize()
                }).done(function (data) {
                    if (data.success === true) {
                        console.log(data)
                        var dt = new Date();
                        var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
                        $('.toast-body').html('Saved ripper settings at ' + time)
                        $('.toast').toast('show');
                    }
                });
            })
            $(".popovers").popover({
                trigger: "hover",
            });
            {% if form.errors %}
                {% for k in form.errors %}
                    $("[name='{{k}}']").addClass("is-invalid");
                {% endfor %}
            {% endif %}
            activeTab("armsettings");
        });
    </script>
{% endblock %}
